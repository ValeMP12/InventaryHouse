var http    = require('http'),
    needle  = require('needle'),
    backend = require('./fake_app_server');

var port  = process.argv[2] || 3000;
var delay = process.argv[3] || 3000;
var request_count = process.argv[4];

http.globalAgent.maxSockets = request_count;

var sendRequests = function(count){

  for(i = 0; i < count; i++){
    console.log('Sending request ' + i);
    needle.get('localhost:' + port);
  }

}

var server = backend.start({
   delay: delay,
   port: port
})

console.log('Listening on port ' + port);

if (request_count) sendRequests(request_count);
