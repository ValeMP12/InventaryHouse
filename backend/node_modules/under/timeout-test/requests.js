var http   = require('http'),
    needle = require('needle');

var count = process.argv[2] || 1000;
var port  = process.argv[3] || 9000;

// http.globalAgent.maxSockets = count;

var opts = {
  timeout: 1000
}

var done = function() {
  console.log('All done')  
}

var get = function(i) {
  needle.get('localhost:' + port + '/number' + i, opts, function(err, resp) {
    console.log(err || resp.statusCode)
    --count || done();
  })  
}

for (var i = 0; i < count; i++) {
  get(i)
}